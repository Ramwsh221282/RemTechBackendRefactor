<section class="max-w-7.5xl mx-auto p-6 space-y-6">
	<div class="p-6 rounded-lg flex flex-col min-h-[260px] relative">
		<div class="flex flex-row items-center justify-between mb-4">
			<h2 class="text-2xl font-bold">Мониторинг активности пользователей</h2>
			<i class="pi pi-chart-bar" style="font-size: 48px; color: #8884; pointer-events: none; z-index: 0"></i>
		</div>
		<section class="grid grid-cols-2 gap-4">
			<p-chart
				class="p-4 flex flex-col gap-4 rounded-lg shadow-sm bg-gradient-to-br from-blue-100 via-white to-blue-200 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700"
				type="line"
				[options]="activityChartOptions"
				[data]="activityChartData"
				style="width: 100%; height: 100%; display: block"
			></p-chart>
			<div
				class="p-4 flex flex-col justify-start gap-4 rounded-lg shadow-sm bg-gradient-to-br from-blue-100 via-white to-blue-200 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700"
			>
				<div class="grid grid-cols-2 gap-4">
					<input pInputText [pSize]="'small'" [fluid]="true" [placeholder]="'Искать по логину'" />
					<input pInputText [pSize]="'small'" [fluid]="true" [placeholder]="'Искать по email'" />
				</div>
				<div class="grid grid-cols-2 gap-4">
					<p-select [fluid]="true" [size]="'small'" [placeholder]="'Статусы операций'" />
					<p-select [fluid]="true" [size]="'small'" [placeholder]="'Права пользователя'" />
				</div>
				<div class="grid grid-cols-2 gap-4">
					<!-- TODO: лучше тут select с поиском и фильтрацией -->
					<input pInputText [pSize]="'small'" [fluid]="true" [placeholder]="'Искать по названию действия'" />
					<p-date-picker
						[selectionMode]="'range'"
						[size]="'small'"
						[placeholder]="'Выбрать диапазон дат'"
						[dateFormat]="'dd.mm.yy'"
					/>
				</div>
				<div class="grid grid-cols-2 gap-4">
					<div class="flex flex-row items-center gap-4">
						<span class="flex items-center gap-1">
							Убрать себя
							<p-check-box></p-check-box>
						</span>
						<span class="flex items-center gap-1">
							Убрать ошибки
							<p-check-box></p-check-box>
						</span>
					</div>
				</div>
			</div>
		</section>
	</div>
	<div class="rounded-lg shadow p-4 overflow-x-auto">
		<p-table
			[alwaysShowPaginator]="true"
			[value]="actionRecords"
			[scrollable]="true"
			scrollHeight="400px"
			class="min-w-full bg-transparent"
		>
			<ng-template pTemplate="header">
				<tr>
					<th class="border px-2 py-2 bg-blue-100 dark:bg-gray-800 text-left sticky top-0 z-10">Дата и время</th>
					<th class="border px-2 py-2 bg-blue-100 dark:bg-gray-800 text-left sticky top-0 z-10">Пользователь</th>
					<th class="border px-2 py-2 bg-blue-100 dark:bg-gray-800 text-left sticky top-0 z-10">Действие</th>
					<th class="border px-2 py-2 bg-blue-100 dark:bg-gray-800 text-left sticky top-0 z-10">Серьёзность</th>
					<th class="border px-2 py-2 bg-blue-100 dark:bg-gray-800 text-left sticky top-0 z-10">Ошибка</th>
				</tr>
			</ng-template>
			<ng-template pTemplate="body" let-record let-rowIndex="rowIndex">
				<tr>
					<td class="border px-2 py-2 whitespace-nowrap align-middle">{{ record.OccuredDateTime | date: "dd.MM.yyyy HH:mm" }}</td>
					<td class="border px-2 py-2 whitespace-nowrap align-middle">
						@if (record.InvokerId) {
							<i class="pi pi-user mr-1 text-blue-500"></i>
						}
						<span>{{ record.InvokerId || "-" }}</span>
					</td>
					<td class="border px-2 py-2 whitespace-nowrap align-middle">{{ record.Name }}</td>
					<td class="border px-2 py-2 whitespace-nowrap align-middle">
						<span
							class="inline-flex items-center gap-1 font-semibold"
							[ngClass]="{
								'text-green-600': record.Severity === 'Info',
								'text-yellow-600': record.Severity === 'Warning',
								'text-red-600': record.Severity === 'Error' || record.Severity === 'Critical',
							}"
						>
							@if (record.Severity === "Info") {
								<i class="pi pi-info-circle"></i>
							}
							@if (record.Severity === "Warning") {
								<i class="pi pi-exclamation-triangle"></i>
							}
							@if (record.Severity === "Critical") {
								<i class="pi pi-times-circle"></i>
							}

							{{ record.Severity }}
						</span>
					</td>
					<td class="border px-2 py-2 whitespace-nowrap align-middle">
						@if (record.Error) {
							<ng-container>
								<i class="pi pi-times-circle text-red-500 mr-1"></i>
								<span class="text-red-500">{{ record.Error }}</span>
							</ng-container>
						}

						<ng-template #noError><span class="text-gray-400">—</span></ng-template>
					</td>
				</tr>
			</ng-template>
		</p-table>
		<app-pagination [total_count]="10" [page_size]="10" [current_page]="1"></app-pagination>
	</div>
</section>
